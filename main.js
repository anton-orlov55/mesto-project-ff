(()=>{"use strict";var e="";const t=e+"0863e5bc26221680f1e2.svg";function n(e,t,n,o,a){const r=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),s=r.querySelector(".card__image"),l=r.querySelector(".card__title"),c=r.querySelector(".card__delete-button"),i=r.querySelector(".card__like-button"),u=r.querySelector(".card__like-count");return s.src=e.link,s.alt=e.name,l.textContent=e.name,u&&(u.textContent=e.likes.length),c&&e.owner._id!==a&&(c.style.display="none"),i&&e.likes.some((e=>e._id===a))&&i.classList.add("card__like-button_is-active"),c&&c.addEventListener("click",(()=>t(r,e._id))),i&&i.addEventListener("click",(()=>n(i,e._id,u))),s.addEventListener("click",(()=>o(e))),r}let o=null;const a=e=>{"Escape"===e.key&&o&&s(o)},r=e=>{o&&s(o),e.classList.add("popup_is-opened"),o=e,document.addEventListener("keydown",a)},s=e=>{e.classList.remove("popup_is-opened"),o===e&&(o=null,document.removeEventListener("keydown",a))},l={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},c={valueMissing:"Вы пропустили это поле",typeMismatch:"Введите адрес сайта",tooShort:"Минимальная длина - {minLength} символа",tooLong:"Максимальная длина - {maxLength} символов",patternMismatch:"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы"},i=/^[A-Za-zА-Яа-яЁё\s\-]+$/,u=(e,t,n)=>{const o=e.querySelector(`.${t.id}-error`);o&&(t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent="")},d=e=>"name"!==e.name&&"about"!==e.name||i.test(e.value),m=e=>"name"===e.name?e.value.length>=2&&e.value.length<=40:"about"!==e.name||e.value.length>=2&&e.value.length<=200,p=(e,t,n)=>{const o=e.some((e=>!e.validity.valid||!d(e)||!m(e)));t&&(o?(t.classList.add(n.inactiveButtonClass),t.disabled=!0):(t.classList.remove(n.inactiveButtonClass),t.disabled=!1))},h=(e,t)=>{const n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((n=>{u(e,n,t)})),p(n,o,t)},_={baseUrl:"https://nomoreparties.co/v1/wff-cohort-42",headers:{authorization:"9553c97e-9623-4b3a-b85e-98cc9c21417d","Content-Type":"application/json"}},v=e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`),y=e=>fetch(`${_.baseUrl}/cards/likes/${e}`,{method:"PUT",headers:_.headers}).then(v),f=e=>fetch(`${_.baseUrl}/cards/likes/${e}`,{method:"DELETE",headers:_.headers}).then(v);let b=null;const g=document.querySelector(".header__logo");g&&(g.src=t);const S=document.querySelector(".popup__image"),L=document.querySelector(".popup__caption");Promise.all([fetch(`${_.baseUrl}/users/me`,{headers:_.headers}).then(v),fetch(`${_.baseUrl}/cards`,{headers:_.headers}).then(v)]).then((([e,t])=>{b=e._id,P(e),function(e,t){e.forEach((e=>{const o=n(e,T,((e,t,n)=>B(e,t,n)),D,t);$.append(o)}))}(t,b)})).catch((e=>console.log(e))),(e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach((t=>{((e,t)=>{const n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);p(n,o,t),n.forEach((a=>{a.addEventListener("input",(()=>{((e,t,n)=>{const o=d(t),a=m(t);if(t.validity.valid&&o&&a)u(e,t,n);else{const o=((e,t)=>t.valueMissing?c.valueMissing:d(e)?"name"===e.name&&e.value.length<2?c.tooShort.replace("{minLength}","2"):"name"===e.name&&e.value.length>40?c.tooLong.replace("{maxLength}","40"):"about"===e.name&&e.value.length<2?c.tooShort.replace("{minLength}","2"):"about"===e.name&&e.value.length>200?c.tooLong.replace("{maxLength}","200"):t.typeMismatch&&"url"===e.type?c.typeMismatch:e.validationMessage:c.patternMismatch)(t,t.validity);((e,t,n,o)=>{const a=e.querySelector(`.${t.id}-error`);a&&(t.classList.add(o.inputErrorClass),a.textContent=n,a.classList.add(o.errorClass))})(e,t,o,n)}})(e,a,t),p(n,o,t)}))}))})(t,e)}))})(l);const C=document.querySelector(".profile__edit-button"),q=document.querySelector(".profile__add-button"),k=document.querySelector(".profile__image"),E=document.querySelector(".profile__title"),x=document.querySelector(".profile__description"),$=document.querySelector(".places__list"),U={editProfile:document.querySelector(".popup_type_edit"),addCard:document.querySelector(".popup_type_new-card"),avatar:document.querySelector(".popup_type_avatar"),imageView:document.querySelector(".popup_type_image")},w=document.forms["edit-profile"],A=document.forms["new-place"],M=document.forms["avatar-form"];function P(e){E.textContent=e.name,x.textContent=e.about,k.style.backgroundImage=`url(${e.avatar})`}function T(e,t){(e=>fetch(`${_.baseUrl}/cards/${e}`,{method:"DELETE",headers:_.headers}).then(v))(t).then((()=>e.remove())).catch((e=>console.log(e)))}function B(e,t,n){!function(e,t,n,o,a){e.classList.contains("card__like-button_is-active")?a(t).then((t=>{e.classList.remove("card__like-button_is-active"),n&&(n.textContent=t.likes.length)})).catch((e=>console.log(e))):o(t).then((t=>{e.classList.add("card__like-button_is-active"),n&&(n.textContent=t.likes.length)})).catch((e=>console.log(e)))}(e,t,n,y,f)}function D(e){S.src=e.link,S.alt=e.name,L.textContent=e.name,r(U.imageView)}Object.values(U).forEach((e=>{e.addEventListener("mousedown",(t=>{(t.target===e||t.target.closest(".popup__close"))&&s(e)}))})),C.addEventListener("click",(()=>{w.elements.name&&(w.elements.name.value=E.textContent),w.elements.about&&(w.elements.about.value=x.textContent),h(w,l),r(U.editProfile)})),q.addEventListener("click",(()=>{A.reset(),h(A,l),r(U.addCard)})),k.addEventListener("click",(()=>{M.reset(),h(M,l),r(U.avatar)})),w.addEventListener("submit",(e=>{e.preventDefault();const t=w.querySelector(".popup__button"),n=t.textContent;var o,a;t.textContent="Сохранение...",(o=w.elements.name.value,a=w.elements.about.value,fetch(`${_.baseUrl}/users/me`,{method:"PATCH",headers:_.headers,body:JSON.stringify({name:o,about:a})}).then(v)).then((e=>{P(e),s(U.editProfile)})).catch((e=>console.log(e))).finally((()=>t.textContent=n))})),A.addEventListener("submit",(e=>{e.preventDefault();const t=A.querySelector(".popup__button"),o=t.textContent;var a,r;t.textContent="Сохранение...",(a=A.elements.name.value,r=A.elements.link.value,fetch(`${_.baseUrl}/cards`,{method:"POST",headers:_.headers,body:JSON.stringify({name:a,link:r})}).then(v)).then((e=>{const t=n(e,T,((e,t,n)=>B(e,t,n)),D,b);$.prepend(t),A.reset(),s(U.addCard)})).catch((e=>console.log(e))).finally((()=>t.textContent=o))})),M.addEventListener("submit",(e=>{e.preventDefault();const t=M.querySelector(".popup__button"),n=t.textContent;var o;t.textContent="Сохранение...",(o=M.elements.avatar.value,fetch(`${_.baseUrl}/users/me/avatar`,{method:"PATCH",headers:_.headers,body:JSON.stringify({avatar:o})}).then(v)).then((e=>{k.style.backgroundImage=`url(${e.avatar})`,s(U.avatar)})).catch((e=>console.log(e))).finally((()=>t.textContent=n))}))})();